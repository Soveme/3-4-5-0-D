<!doctype html>
<html lang="ru">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>История</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
        <link rel="stylesheet" href="/static/main.css" type="text/css">
	    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    </head>

    <div class="balls">
        <div class="ball-1 ball"></div>
        <div class="ball-2 ball"></div>
        <div class="ball-3 ball"></div>
    </div>


    <body>

        <header class="sticky-top">
            <div class="container head-con">
                <div class="row head-row">
                    <div class="col-2 head-text">
                        <button class="btn btn-toggle">
                            <a href="/dashboard">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 -960 960 960" fill="var(--bs-body-color)"><path d="M640-80 240-480l400-400 71 71-329 329 329 329-71 71Z"/></svg>
                            </a>
                        </button>
                    </div>
                    <div class="col-6 head-text"><h1>Операции</h1></div>
                    <div class="col-2 head-text" >
                        <button class="btn btn-toggle col">
                            <a href="budget.html">
                                <svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 -960 960 960" fill="var(--bs-body-color)"><path d="M336-120q-91 0-153.5-62.5T120-336q0-38 13-74t37-65l142-171-97-194h530l-97 194 142 171q24 29 37 65t13 74q0 91-63 153.5T624-120H336Zm144-200q-33 0-56.5-23.5T400-400q0-33 23.5-56.5T480-480q33 0 56.5 23.5T560-400q0 33-23.5 56.5T480-320Zm-95-360h190l40-80H345l40 80Zm-49 480h288q57 0 96.5-39.5T760-336q0-24-8.5-46.5T728-423L581-600H380L232-424q-15 18-23.5 41t-8.5 47q0 57 39.5 96.5T336-200Z"/></svg>
                            </a>
                        </button>
                    </div>
                    <div class="col-2 head-text" >
                        <button class="btn btn-toggle col">
                            <a href="/helper/{{id}}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 -960 960 960" fill="var(--bs-body-color)"><path d="M120-120v-80l80-80v160h-80Zm160 0v-240l80-80v320h-80Zm160 0v-320l80 81v239h-80Zm160 0v-239l80-80v319h-80Zm160 0v-400l80-80v480h-80ZM120-327v-113l280-280 160 160 280-280v113L560-447 400-607 120-327Z"/></svg>
                            </a>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <main>
            <div class="container body-con">

                <div class="row">
                    <label for="">Бюджет на расходы</label>
                    <h1 class="money">27 258 / 50 000 ₽</h1>
                </div>
                <!-- 3 кнопки сверху -->
                <div class="row">
                    <div class="col dropdown-center">
                        <button class="btn mini-btn c"
                            data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false">
                            за месяц
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item ps-3" href="#">неделю</a></li>
                            <li><a class="dropdown-item ps-3" href="#">месяц</a></li>
                            <li><a class="dropdown-item ps-3" href="#">год</a></li>
                        </ul>
                    </div>

                    <div class="col dropdown-center">
                        <button class="btn mini-btn c"
                            data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false">
                            Саня
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item ps-3" href="#">Саня</a></li>
                            <li><a class="dropdown-item ps-3" href="#">Ваня</a></li>
                            <li><a class="dropdown-item ps-3" href="#">Таня</a></li>
                        </ul>
                    </div>

                    <div class="col dropdown-center">
                        <button class="btn mini-btn c"
                            data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false">
                            траты
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item ps-3" href="#">всего</a></li>
                            <li><a class="dropdown-item ps-3" href="#">траты</a></li>
                            <li><a class="dropdown-item ps-3" href="#">доход</a></li>
                        </ul>
                    </div>
                </div>
                <!-- 3 кнопки сверху -->
                <div class="row">
                    <h1 class="money">22 742 ₽</h1>

                    <div class="row chart-container" id="graph-collapse">
                        <canvas id="donutChart" class="donutChart"></canvas>
                        <div id="customLegend" class="legend-list flexy"></div>
                    </div>
                </div>




                <div class="row ">

                    <!-- один день -->
                    <label>23 Апреля</label>
                    <button class="btn btn-block">
                        <div class="col volume">
                            <a href="edit-pay.html">
                            <div class="row">
                                <div class="col-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="svg-block" width="100%" viewBox="0 -960 960 960" fill="var(--bs-body-color)"><path d="M320-200h280v-400h-80q-28 0-46 14t-43 41q-20 22-46.5 45.5T320-465v265Zm-80 80v-346q-52-14-86-56t-34-98q0-53 30.5-94t78.5-57q23-48 68.5-78T400-879q35 0 65.5 12t55.5 32q10-2 19-3.5t20-1.5q66 0 113 47t47 113q0 22-5.5 42T698-600h62q33 0 56.5 23.5T840-520v240q0 33-23.5 56.5T760-200h-80v80H240Zm-40-500q0 33 23.5 56.5T280-540q32 0 54.5-21t46.5-47q25-27 56.5-49.5T520-680h120q0-33-23.5-56.5T560-760q-25 0-42 6.5l-17 6.5-31-26q-11-9-28.5-17.5T400-799q-32 0-58.5 17T301-736l-14 30-32 11q-25 8-40 28.5T200-620Zm480 340h80v-240h-80v240Zm-360 80h280-280Z"/></svg>
                                </div>
                                <div class="col">
                                    Развлечения
                                </div>
                                <div class="col">
                                    <div class="row">-1 234 ₽</div>
                                    <div class="row">Саня</div>
                                </div>
                            </div>
                            </a>
                        </div>
                    </button>
                    <button class="btn btn-block">
                        <div class="col volume"></div>
                    </button>
                    <!-- один день -->

                     <label>23 Апреля</label>
                    <button class="btn btn-block">
                        <div class="col volume"></div>
                    </button>
                    <button class="btn btn-block">
                        <div class="col volume"></div>
                    </button>
                    <button class="btn btn-block">
                        <div class="col volume"></div>
                    </button>
                    <button class="btn btn-block">
                        <div class="col volume"></div>
                    </button>
                    <button class="btn btn-block">
                        <div class="col volume"></div>
                    </button>

                </div>

            </div>



        </main>


        <footer class="fixed-bottom">
            <div class="container footer-con">
                <div class="row">
                    <a href="/dashboard/{{id}}/plus" class="col btn-footer btn">
                        <svg xmlns="http://www.w3.org/2000/svg" height="100%" viewBox="0 -960 960 960" fill="var(--bs-body-color)"><path d="M440-440H200v-80h240v-240h80v240h240v80H520v240h-80v-240Z"/></svg>
                    </a>

                    <a href="/dashboard/{{id}}/minus"  class="col btn-footer btn">
                        <svg xmlns="http://www.w3.org/2000/svg" height="100%" viewBox="0 -960 960 960" fill="var(--bs-body-color)"><path d="M200-440v-80h560v80H200Z"/></svg>
                    </a>
                </div>
            </div>
        </footer>



        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    </body>


<script>
	const testData = [
		{ category: "Еда", amount: 300 },
		{ category: "Транспорт", amount: 150 },
		{ category: "Развлечения", amount: 100 },
		{ category: "Счета", amount: 200 }
	];

	const getRandomColor = () => {
		const letters = '0123456789ABCDEF';
		let color = '#';
		for (let i = 0; i < 6; i++) {
			color += letters[Math.floor(Math.random() * 16)];
		}
		return color;
	};

	const originalColors = testData.map(() => getRandomColor());
	let selectedCategory = null;

	const chartData = {
		labels: testData.map(item => item.category),
		datasets: [{
			data: testData.map(item => item.amount),
			backgroundColor: originalColors.slice(),
			borderWidth: 0,
            // borderColor: '#000',
			borderRadius: 50,
			spacing: 5,
			cutout: '80%'
        }]
	};

	const canvas = document.getElementById('donutChart');
	const donutChart = new Chart(canvas, {
		type: 'doughnut',
		data: chartData,
		options: {
			responsive: true,
			plugins: {
				legend: {
					display: false // Отключаем встроенную легенду
				},
				tooltip: {
					callbacks: {
						label: function (tooltipItem) {
							return `${tooltipItem.label}: $${tooltipItem.raw}`;
						}
					},
					enabled: true
				}
			},
			hover: {
				mode: null
			}
		}
	});

	// Рисуем свою легенду справа
	const legendContainer = document.getElementById('customLegend');
	chartData.labels.forEach((label, i) => {
		const item = document.createElement('div');
		item.className = 'legend-item';

		const colorBox = document.createElement('span');
		colorBox.className = 'legend-color';
		colorBox.style.backgroundColor = originalColors[i];

		const text = document.createElement('span');
		text.textContent = label;

		item.appendChild(colorBox);
		item.appendChild(text);
		legendContainer.appendChild(item);
	});

	canvas.addEventListener('click', (event) => {
		const elements = donutChart.getElementsAtEventForMode(event, 'nearest', { intersect: true }, false);
		if (elements.length > 0) {
			const index = elements[0].index;
			const category = chartData.labels[index];

			if (selectedCategory === category) {
				selectedCategory = null;
			} else {
				selectedCategory = category;
			}

			chartData.datasets[0].borderWidth = chartData.labels.map(label =>
			 	label === selectedCategory ? 3 : 1
			);
			chartData.datasets[0].borderColor = chartData.labels.map(label =>
				label === selectedCategory ? '#ffffff' : '#000000'
			);

			donutChart.update();
		}
	});
</script>

</html>